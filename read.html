<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Reader</title>

<style>
body{
  margin:0;
  background:#0B1020;
  color:#EAF0FF;
  font-family:Georgia,serif;
  overflow:hidden;
}

.top{
  position:fixed;
  top:0;
  left:0;
  right:0;
  padding:16px;
  display:flex;
  justify-content:space-between;
  background:#0f1731;
  z-index:10;
}

button{
  background:#7c5cff;
  border:none;
  color:white;
  padding:8px 16px;
  border-radius:8px;
  cursor:pointer;
}

button:hover{
  opacity:.85;
}

.stage{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding-top:70px;
}

.book{
  width:min(1100px,95vw);
  height:min(760px,85vh);
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}

.page{
  background:#121a33;
  border-radius:18px;
  padding:30px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  box-shadow:0 30px 90px rgba(0,0,0,.6);
}

.content{
  overflow:hidden;
  line-height:1.8;
  font-size:17px;
}

.footer{
  text-align:right;
  font-size:12px;
  opacity:.6;
}

@media(max-width:800px){
  .book{
    grid-template-columns:1fr;
  }
}
</style>
</head>

<body>

<div class="top">
<div>
<button onclick="prev()">Prev</button>
<button onclick="next()">Next</button>
</div>
<div>
<button onclick="location.href='index.html'">Library</button>
</div>
</div>

<div class="stage">
<div class="book">
<div class="page">
<div class="content" id="left"></div>
<div class="footer" id="leftNum"></div>
</div>
<div class="page">
<div class="content" id="right"></div>
<div class="footer" id="rightNum"></div>
</div>
</div>
</div>

<script>
const params=new URLSearchParams(location.search);
const book=params.get("book")||"book1";

let pages=[];
let index=0;

fetch("books/"+book+".html")
.then(r=>r.text())
.then(html=>{
  const container=document.createElement("div");
  container.innerHTML=html;
  paginate(container);
  render();
});

function paginate(container){
  const temp=document.createElement("div");
  temp.style.visibility="hidden";
  temp.style.position="absolute";
  temp.style.width="45%";
  temp.style.lineHeight="1.8";
  temp.style.fontSize="17px";
  document.body.appendChild(temp);

  let page=document.createElement("div");

  [...container.children].forEach(el=>{
    const clone=el.cloneNode(true);
    page.appendChild(clone);
    temp.innerHTML=page.innerHTML;
    if(temp.scrollHeight>700){
      page.removeChild(clone);
      pages.push(page.innerHTML);
      page=document.createElement("div");
      page.appendChild(clone);
    }
  });

  pages.push(page.innerHTML);
  document.body.removeChild(temp);
}

function render(){
  document.getElementById("left").innerHTML=pages[index]||"";
  document.getElementById("right").innerHTML=pages[index+1]||"";
  document.getElementById("leftNum").innerText=index+1;
  document.getElementById("rightNum").innerText=index+2;
}

function next(){
  if(index+2<pages.length){
    index+=2;
    render();
  }
}

function prev(){
  if(index-2>=0){
    index-=2;
    render();
  }
}
</script>

</body>
</html>
