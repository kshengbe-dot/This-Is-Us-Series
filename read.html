<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>THIS IS US — Reader</title>

<style>
:root{
  --bg:#0B1020;
  --paper:#121A33;
  --ink:#EAF0FF;
  --muted:#9FB0D6;
  --stroke:rgba(255,255,255,.12);
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:Georgia, serif;
}

.top{
  height:60px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
  border-bottom:1px solid var(--stroke);
}

button{
  padding:8px 14px;
  background:#1a2242;
  border:1px solid var(--stroke);
  color:white;
  border-radius:8px;
  cursor:pointer;
}

.stage{
  display:flex;
  justify-content:center;
  padding:30px 20px;
}

.book{
  width:min(1000px,95vw);
}

.page{
  background:var(--paper);
  border:1px solid var(--stroke);
  border-radius:12px;
  padding:40px 32px;
  line-height:1.8;
  font-size:17px;
  min-height:70vh;
}

.chapter{
  page-break-before:always;
  margin-top:60px;
}

h3{
  text-transform:uppercase;
  letter-spacing:.2em;
  font-size:12px;
  color:var(--muted);
}

h4{
  font-size:28px;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="top">
  <button onclick="location.href='./'">← Library</button>
  <div>
    <button onclick="prev()">Prev</button>
    <button onclick="next()">Next</button>
  </div>
</div>

<div class="stage">
  <div class="book">
    <div class="page" id="page"></div>
  </div>
</div>

<script>
const BOOKS={
  book1:"./books/book1.html",
  coming:"./books/coming-soon.html"
};

const params=new URLSearchParams(location.search);
const book=params.get("book")||"book1";
const file=BOOKS[book];

let content="";
let pages=[];
let current=0;

async function load(){
  const res=await fetch(file);
  content=await res.text();
  paginate();
  render();
}

function paginate(){
  pages=[];
  const temp=document.createElement("div");
  temp.innerHTML=content;

  const blocks=[...temp.children];
  let page=document.createElement("div");

  blocks.forEach(block=>{
    if(block.classList.contains("chapter-title")){
      pages.push(page.innerHTML);
      page=document.createElement("div");
    }

    page.appendChild(block.cloneNode(true));

    if(page.innerText.length>1800){
      pages.push(page.innerHTML);
      page=document.createElement("div");
    }
  });

  if(page.innerHTML.trim()!==""){
    pages.push(page.innerHTML);
  }
}

function render(){
  document.getElementById("page").innerHTML=pages[current]||"";
}

function next(){
  if(current<pages.length-1){
    current++;
    render();
  }
}

function prev(){
  if(current>0){
    current--;
    render();
  }
}

load();
</script>

</body>
</html>
