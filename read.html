<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>THIS IS US — Reader</title>

<style>
:root{
  --bg:#0B1020;
  --paper:#121A33;
  --ink:#EAF0FF;
  --muted:#9FB0D6;
  --stroke:rgba(255,255,255,.12);
}

body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:Georgia, serif;
  overflow-x:hidden;
  transition:.3s;
}

.top{
  height:64px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
  border-bottom:1px solid var(--stroke);
}

.controls{
  display:flex;
  gap:10px;
  align-items:center;
}

button{
  padding:8px 14px;
  background:#1a2242;
  border:1px solid var(--stroke);
  color:white;
  border-radius:8px;
  cursor:pointer;
}

button:hover{
  opacity:.8;
}

.stage{
  display:flex;
  justify-content:center;
  padding:40px 20px;
}

.book{
  display:flex;
  gap:30px;
  width:min(1100px,95vw);
}

.page{
  flex:1;
  background:var(--paper);
  border:1px solid var(--stroke);
  border-radius:14px;
  padding:50px 40px;
  line-height:1.9;
  font-size:18px;
  min-height:75vh;
  overflow:hidden;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
  animation:fade .4s ease;
}

@keyframes fade{
  from{opacity:0; transform:translateX(10px);}
  to{opacity:1; transform:none;}
}

h3{
  text-transform:uppercase;
  letter-spacing:.2em;
  font-size:12px;
  color:var(--muted);
}

h4{
  font-size:28px;
  margin-top:8px;
}

.dropcap:first-letter{
  float:left;
  font-size:48px;
  line-height:1;
  padding-right:6px;
}

.counter{
  color:var(--muted);
  font-size:14px;
}

/* Mobile */

@media(max-width:900px){
  .book{
    flex-direction:column;
  }
  .page{
    min-height:70vh;
  }
}
</style>
</head>

<body>

<div class="top">
  <button onclick="location.href='./'">← Library</button>

  <div class="controls">
    <span class="counter" id="counter"></span>
    <button onclick="prev()">Prev</button>
    <button onclick="next()">Next</button>
    <button onclick="toggleTheme()">Theme</button>
  </div>
</div>

<div class="stage">
  <div class="book">
    <div class="page" id="left"></div>
    <div class="page" id="right"></div>
  </div>
</div>

<script>
const BOOKS={
  book1:"./books/book1.html",
  coming:"./books/coming-soon.html"
};

const params=new URLSearchParams(location.search);
const book=params.get("book")||"book1";
const file=BOOKS[book];

let content="";
let pages=[];
let current=0;

async function load(){
  const res=await fetch(file);
  content=await res.text();
  paginate();
  loadProgress();
  render();
}

function paginate(){
  pages=[];
  const temp=document.createElement("div");
  temp.innerHTML=content;

  const blocks=[...temp.children];
  let page=document.createElement("div");

  blocks.forEach(block=>{
    page.appendChild(block.cloneNode(true));

    if(page.innerText.length>1800){
      pages.push(page.innerHTML);
      page=document.createElement("div");
    }
  });

  if(page.innerHTML.trim()!==""){
    pages.push(page.innerHTML);
  }
}

function render(){
  const left=document.getElementById("left");
  const right=document.getElementById("right");

  left.innerHTML=pages[current]||"";
  right.innerHTML=pages[current+1]||"";

  document.getElementById("counter").innerText =
    "Page " + (current+1) + " / " + pages.length;

  saveProgress();
}

function next(){
  if(current+2 < pages.length){
    current+=2;
    render();
  }
}

function prev(){
  if(current-2 >=0){
    current-=2;
    render();
  }
}

function saveProgress(){
  localStorage.setItem("progress_"+book,current);
}

function loadProgress(){
  const saved=localStorage.getItem("progress_"+book);
  if(saved){
    current=parseInt(saved);
  }
}

function toggleTheme(){
  const body=document.body;
  if(body.style.background=="rgb(245, 239, 224)"){
    body.style.background="#0B1020";
    body.style.color="#EAF0FF";
  }else{
    body.style.background="#F5EFE0";
    body.style.color="#2A2A2A";
  }
}

load();
</script>

</body>
</html>
